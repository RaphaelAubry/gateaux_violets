<div class="left">
  <div class="show">
    <div>

      <!-- flow management -->
      <div class="flow">
        <p id="flow" data-status=<%= "#{@basket.status}" %>></p>
        <div class="horizontal">
          <div class="" id="basket"><%= Basket::STATUS[0] %></div>
          <div class="space"> >> </div>
          <div class="" id="delivery"><%= Basket::STATUS[1] %></div>
          <div class="space"> >> </div>
          <div class="" id="payment"><%= Basket::STATUS[2] %></div>
          <div class="space"> >> </div>
          <div class="" id="invoice"><%= "Invoice" %></div>
        </div>
      </div>

      <!-- stage basket -->
      <div class="basket">
        <div class="title">
          <h1>My basket</h1>
        </div>

        <!-- table -->
        <div>
            <div class="horizontal">
              <p class="tabl-name"></p>
              <p class="tabl-date">To</p>
              <p class="tabl-price">Price</p>
              <p class="tabl-quantity">Quantity</p>
            </div>

          <% @basket.lines.each do |line| %>
          <% @total += line.total  %>
            <div class="horizontal">
              <%= link_to edit_line_path(line) do %>
                <p class="tabl-name"><%= line.cake.name %></p>
                <p class="tabl-date"><%= TimeFr(line.delivery_date) %></p>
                <p class="tabl-price"><%= d2(line.cake.price) %></p>
                <p class="tabl-quantity"><%= line.quantity %></p>
                <!-- <% @line = line %><% @cake = line.cake %>
                <%= render 'lines/basket', locals: { line: @line, cake: @cake}, class: "tabl-quantity" %> -->
                <p class="tabl-total"><%= d2(line.total) %><%= currency() %></p>
              <% end %>
              <p class="tabl-icon"><%= link_to "", edit_line_path(line), class: "fas fa-edit" %></p>
              <p class="tabl-icon"><%= link_to "", line_path(line), method: :delete, data: { confirm: "Are you sure ?" }, class: "fas fa-trash", remote: true %></p>
            </div>
            <p class="tabl-date-smallscreen">To <%= TimeFr(line.delivery_date) %></p>
          <% end %>
          <div class="basket-total"><p><%= d2(@total) %></p><p><%= ApplicationHelper::CURRENCY %></p></div>
        </div>

        <div>
          <div class="button-wrapper">
            <%= link_to "Order more", :home, class: "button" %>
          </div>
          <div class="button-wrapper">
            <%= link_to 'delete', basket_path(@basket), method: :delete, data: { confirm: "Are you sure ?" }, class: "button", remote: true %>
          </div>
        </div>

        <!-- flow forms -->
        <div class="horizontal">
          <%= render 'baskets/basket_forward', basket: @basket, remote: true %>
          <%= render 'baskets/basket_backward', basket: @basket, remote: true %>
        </div>
      </div>

      <!-- stage delivery -->
      <div class="delivery">

        <div class="title">
          <h1>Delivery</h1>
        </div>

        <div class="address">
          <div>
            <div class="invoicing-address">
              <h3>Invoicing Address</h3>

              <% if current_user.addresses.exists? %>
                <%= render 'address', local: { basket: @basket, address: @address } %>
              <% else %>
                <%= link_to 'new', new_address_path, class: "button" %>
              <% end %>
            </div>

            <div class="delivery-contact">
              <h3>Contact</h3>

              <%= render 'baskets/contact', local: { basket: @basket, address: @address } %>
            </div>
          </div>

          <div>
            <div class="delivery-address">
              <h3>Delivery Address</h3>

               <%= render 'takeaway' %>
            </div>
          </div>
        </div>

        <!-- flow forms -->
        <div class="horizontal">
          <%= render 'baskets/basket_forward', basket: @basket, remote: true %>
          <%= render 'baskets/basket_backward', basket: @basket, remote: true %>
        </div>
      </div>

      <!-- stage payment -->
      <div class="payment">
        <div class="title">
          <h1>My payment</h1>
        </div>
        <div class="payment">
          <div class="horizontal">
            <p id="total"><%= d2(@total) %></p>
            <p><%= ApplicationHelper::CURRENCY %></p>
          </div>
          <% if @basket.payment_type.nil? %>
            <%= render 'baskets/payment' %>
          <% else %>
             <p class="tabl-email"><%= @basket.payment_type %></p>
          <% end %>


          <div class="message">
          Dès réception de votre règlement, je commence à préparer votre commande.
          </div>
        </div>

        <!-- flow forms -->
        <div class="horizontal">
          <%= render 'baskets/basket_forward', basket: @basket, remote: true %>
          <!-- <%= render 'baskets/basket_backward', basket: @basket, remote: true %> -->
        </div>
      </div>

    </div>
  </div>
</div>
